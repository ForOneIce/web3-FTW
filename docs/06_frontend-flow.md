# 前端交互设计文档
交互流程、前端逻辑、页面设计、用户流程图

## 页面总览

### 页面总数：7个主要页面
1. **首页** (`/`) - 网站入口，展示项目价值观和主要操作入口
2. **挑战营总览** (`/camps`) - 显示所有营地列表，支持筛选和搜索
3. **配置营地** (`/create-camp`) - 组织者创建新营地的表单页面
4. **营地详情** (`/camp/:campId`) - 显示单个营地的详细信息
5. **配置关卡** (`/create-level/:campId`) - 组织者配置营地关卡的页面
6. **闯关页面** (`/level/:campId`) - 参与者进行关卡挑战的页面
7. **个人空间** (`/personal`) - 用户个人营地管理页面

### 访问路径地址
```
/                           - 首页
/camps                      - 挑战营总览
/camps?filter=signup        - 挑战营总览（筛选报名开始状态）
/create-camp                - 配置营地
/camp/:campId               - 营地详情（:campId为营地合约地址）
/create-level/:campId       - 配置关卡（:campId为营地合约地址）
/level/:campId              - 闯关页面（:campId为营地合约地址）
/personal                   - 个人空间
```

## 页面跳转逻辑

### 主要跳转流程
1. **首页 → 挑战营总览**：点击"参加"按钮，跳转到 `/camps?filter=signup`
2. **首页 → 配置营地**：点击"发起"按钮，跳转到 `/create-camp`
3. **挑战营总览 → 营地详情**：点击营地卡片，跳转到 `/camp/:campId`
4. **挑战营总览 → 配置营地**：点击"创建营地"按钮，跳转到 `/create-camp`
5. **配置营地 → 营地详情**：创建成功后，跳转到 `/camp/:campId`
6. **营地详情 → 配置关卡**：组织者点击"开启关卡"，跳转到 `/create-level/:campId`
7. **配置关卡 → 营地详情**：配置完成后，跳转到 `/camp/:campId`
8. **营地详情 → 闯关页面**：参与者点击"闯关"，跳转到 `/level/:campId`
9. **闯关页面 → 营地详情**：点击返回按钮，跳转到 `/camp/:campId`
10. **个人空间 → 营地详情**：点击个人营地卡片，跳转到 `/camp/:campId`

### 导航栏跳转
- **Logo点击**：从任何页面点击Logo，跳转到首页 `/`
- **个人空间**：从导航栏下拉菜单点击"个人空间"，跳转到 `/personal`

## 组件交互逻辑

### 全局组件
1. **Navbar组件**：所有页面共享的导航栏
   - 钱包连接/断开功能
   - 语言切换功能
   - 个人空间入口

2. **Web3Context**：全局Web3状态管理
   - 钱包连接状态
   - 用户账户信息
   - 智能合约交互

3. **LanguageContext**：多语言支持
   - 中英文切换
   - 界面文本国际化

##【网站首页】(`/`)
### 前端设计创意
- 配色：红色、黑色、白色，激发挑战斗志
- 背景：通往远方向上的悬浮阶梯，越远越模糊
- 阶梯样式：白色填充黑色边框，像钢琴琴键
- 价值观展示：8个核心价值观文案半透明显示
  - For The Win 为了胜利
  - First To Win 为了赢一次
  - Finish To Win 为了完成挑战
  - For The Web3 为了web3的明天
  - For The Women 为了女性团结
  - Fight The World 为了对抗世界
  - Favorate Team Work 心选战友共筑星河
  - Focus Task Working 聚焦突破穿透万难

### 前端交互逻辑
- **左按钮"发起"**：组织者入口，点击跳转到配置营地页面
- **右按钮"参加"**：参与者入口，点击跳转到挑战营总览页面（默认筛选"报名开始"状态）
- **钱包连接**：未连接钱包时点击按钮，弹出钱包连接弹窗
- **个人设置**：右上角个人设置入口，包含钱包信息和个人空间跳转

### 交互细节
- 鼠标移动时阶梯有视差效果
- 钱包连接支持MetaMask、WalletConnect、Coinbase Wallet、Fortmatic
- 连接成功后自动跳转到目标页面

##【挑战营总览】(`/camps`)
### 页面功能
- 显示所有营地摘要卡片
- 按报名截止日期倒序排列
- 支持按状态筛选：报名开始、开营失败、开营成功、闯关模式、已结营
- 提供"创建营地"按钮

### 卡片设计
- **营地名称**：显示在卡片上区域
- **关卡总数**：显示在卡片下区域左部
- **历史报名人数**：显示在卡片下区域右部
- **状态颜色**：
  - 报名开始：白色背景黑色字体
  - 开营失败：黑色背景白色字体
  - 开营成功：红色背景白色字体
  - 闯关模式：红色背景黄金色字体
  - 已结营：红色背景黑色字体

### 交互逻辑
- 点击卡片跳转到对应营地详情页
- 筛选菜单与对应状态卡片颜色保持一致
- 创建营地按钮跳转到配置营地页面

##【配置营地】(`/create-camp`)
### 表单配置项
- **营地名称**：限制64字节，不能为空，不能有特殊字符
- **报名截止日期**：不能小于当天，提供日历组件
- **结营时间**：不能早于报名截止时间，提供日历组件
- **挑战关卡总数**：正整数，不能小于1
- **参与者数量范围**：最小和最大数量，正整数，最大不能小于最小
- **预付押金金额**：单位wei，正整数，不能小于1

### 交互逻辑
- 表单验证：实时检查输入内容是否符合要求
- 钱包连接检查：需要钱包连接和组织者身份确认
- 二次确认：符合要求后弹出确认弹窗
- 创建成功：跳转到营地详情页面
- 数据保护：刷新页面时提示确认是否保存

##【营地详情】(`/camp/:campId`)
### 前端设计创意
- 主要内容背景：立着的黑白钢琴键盘
- 钢琴键盘作为营地时间生命线，时间轴倒叙展示
- 黑键：营地时间节点（5个），显示节点名称
- 白键：节点详情内容，显示时间、信息、数据、操作按钮
- 当前节点：黑键被按下弹奏的阴影效果

### 状态节点详情

#### 报名开始状态
- **白键1**：报名截止日期
- **白键2**：报名下限-上限人数
- **白键3**：当前已报名人数
- **白键4**：操作按钮"报名"

**报名按钮逻辑**：
- 组织者不能报名自己的营地
- 已参与其他未结束营地的用户不能报名
- 已参与该营地的用户不能重复报名
- 营地状态变更后不能报名
- 满足条件时点击弹出押金支付弹窗
- 支付成功后按钮变为"已报名"且不可点击

#### 开营失败状态
- **白键1**：开营状态（显示开营失败）
- **白键2**：押金状态（显示x人押金待退还）
- **白键3**：操作按钮"退押金"

**退押金按钮逻辑**：
- 仅开营失败状态下可操作
- 仅组织者可操作
- 非组织者点击提示无操作权限
- 操作成功后更新押金状态

#### 开营成功状态
- **白键1**：开营状态（显示开营成功）
- **白键2**：押金状态（显示x人押金已提交）
- **白键3**：操作按钮"开启关卡"

**开启关卡按钮逻辑**：
- 仅组织者可操作
- 点击跳转到配置关卡页面
- 配置完成后返回营地详情页面，状态更新为闯关模式

#### 闯关模式状态
- **白键1**：挑战关卡（显示关卡总数）
- **白键2**：当前进度（显示当前关卡）
- **白键3**：操作按钮"闯关"

**闯关按钮逻辑**：
- 仅已报名的非组织者参与者可操作
- 点击跳转到闯关页面
- 非报名者点击提示无权限

#### 结营状态
- **白键1**：通关人数
- **白键2**：操作按钮"押金赎回"（仅通关者可操作）
- **白键3**：扣押人数
- **白键4**：操作按钮"押金罚扣"（仅组织者可操作，存在失败者时显示）

**押金赎回逻辑**：
- 仅已报名且完全通关的参与者可操作
- 限制重复提款和未结营时操作
- 提取成功后按钮变为不可点击

**押金罚扣逻辑**：
- 仅组织者可操作
- 仅存在失败者时显示
- 提取成功后按钮变为不可点击

##【配置关卡】(`/create-level/:campId`)
### 表单配置项
- **关卡总数**：从营地配置获取
- **结营日期**：从营地配置获取
- **密码等级**：
  - 普通模式：每关通关密文不同
  - 高级模式：每关每人通关密文均不同
- **截止日期**：各关卡截止日期，不能小于当天，不能晚于结营日期
- **密码设置**：待加密处理的通关密码原文，限制长度128

### 交互逻辑
- 表单验证：实时检查输入内容
- 钱包连接检查：需要钱包连接和组织者身份确认
- 二次确认弹窗：显示三个按钮（取消、前端加密、合约密文保存）
- **前端加密**：生成待验证通关密文，支持一键复制
- **合约密文保存**：将密文哈希存储到合约
- 配置成功：跳转回营地详情页面

### 密码生成逻辑
- **普通模式**：x字符串拼接关卡序号生成y，y的hash生成z
- **高级模式**：x字符串拼接关卡序号和参与者序号生成y，y的hash生成z
- 最终存储：z再次hash生成j存储到合约

##【闯关页面】(`/level/:campId`)
### 前端设计创意
- 与营地详情页面相同的钢琴键盘设计
- 黑键数量根据关卡数量确定
- 成功相关交互显示为金黄色，预示奖金收益
- 个人关卡完成率使用进度条展示，红色到金色渐变

### 页面内容
- **白键1**：显示节点截止时间
- **白键2**：显示节点已通过人数
- **白键3**：操作按钮"提交通关密文"

### 交互逻辑
- **权限检查**：
  - 组织者不可点击操作按钮
  - 非组织者且未报名者不可点击操作按钮
  - 仅已报名参与者可操作
- **密码提交**：点击弹出密码输入弹窗
- **验证流程**：二次确认后提交到合约验证
- **状态更新**：验证通过后按钮变为"已通关"且不可点击
- **时间限制**：截止日期超过后无法提交

##【个人空间】(`/personal`)
### 页面结构
- 三个标签页：发起、已参与、可参与
- 可参与：指报名开始状态且非用户创建的营地

### 功能逻辑
- 按用户身份过滤显示相关营地卡片
- 卡片样式与挑战营总览一致
- 点击卡片跳转到对应营地详情页
- 支持标签页切换

## 页面刷新逻辑

### 数据加载策略
- **页面初始化加载**：每个页面在组件挂载时通过`useEffect`钩子自动加载数据
- **依赖项触发刷新**：当关键依赖项（如钱包连接状态、用户账户、营地ID等）发生变化时自动重新加载数据
- **手动刷新**：用户点击重试按钮或手动刷新页面时重新获取数据

### 具体实现方式

#### 挑战营总览页面 (`/camps`)
- **初始化加载**：页面挂载时调用`fetchCampsData()`获取所有营地数据
- **筛选更新**：切换筛选条件时更新URL参数，但不重新请求数据，仅在前端过滤显示
- **错误重试**：加载失败时显示重试按钮，点击后重新调用API

#### 营地详情页面 (`/camp/:campId`)
- **数据获取**：页面挂载时通过`getCampData()`获取营地详细信息
- **依赖监听**：监听`campId`、`language`、`account`等依赖项变化，自动重新获取数据
- **操作后刷新**：报名、配置关卡等操作完成后，等待3秒让后端处理事件，然后自动刷新数据
- **状态检查**：定期调用`checkCampState()`检查营地状态变化

#### 个人空间页面 (`/personal`)
- **条件加载**：仅在钱包连接且有账户时加载数据
- **依赖监听**：监听`isConnected`和`account`变化，自动重新获取用户相关营地
- **标签切换**：切换标签页时在前端过滤数据，不重新请求

#### 其他页面
- **配置营地页面**：表单提交成功后跳转到营地详情页面
- **配置关卡页面**：配置完成后跳转回营地详情页面
- **闯关页面**：密码提交验证后更新本地状态

### 数据缓存策略
- **前端状态缓存**：使用React状态管理缓存已获取的数据
- **无定时刷新**：当前项目未实现定时自动刷新机制
- **实时性保证**：通过操作后的延迟刷新和状态检查确保数据实时性

### 错误处理
- **加载状态**：显示加载动画，提升用户体验
- **错误提示**：显示具体错误信息，提供重试选项
- **降级处理**：部分数据加载失败时，显示可用数据，提示用户手动刷新

## 后续版本优化计划
1. **用户专注限制**：同一时间只能参与一个进行中的营地
2. **时区支持**：默认东八区，支持用户切换时区
3. **权限优化**：完善各种状态下的权限控制
4. **用户体验**：优化加载状态、错误提示、成功反馈

---


**版本**: v1.0.0
**页面总数**: 7个主要页面
**路由总数**: 8个路由（包含404页面）
